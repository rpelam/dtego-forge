<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tests Forge v0.1.1 - Foundation</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #0f0f1a, #1a1a2e, #0f0f1a);
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, sans-serif;
        }
        .glass {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .test-pass { 
            background: rgba(16, 185, 129, 0.1);
            border-left: 4px solid #10b981;
        }
        .test-fail { 
            background: rgba(239, 68, 68, 0.1);
            border-left: 4px solid #ef4444;
        }
        .test-category {
            background: rgba(139, 92, 246, 0.1);
            border-left: 4px solid #8b5cf6;
        }
        .pulse {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body class="min-h-screen p-8">
    <!-- Header -->
    <div class="glass rounded-3xl p-8 mb-6">
        <div class="text-center">
            <h1 class="text-5xl font-bold mb-2" style="color: white; letter-spacing: 0.2em;">Dtego</h1>
            <p class="text-purple-400 text-sm mb-6">Forge - Suite de Tests Automatiques</p>
            
            <div class="inline-block glass rounded-2xl px-6 py-4">
                <div class="grid grid-cols-3 gap-8 text-center">
                    <div>
                        <p class="text-white/40 text-xs mb-1">Version</p>
                        <p class="text-white font-bold text-lg">v0.1.1</p>
                    </div>
                    <div>
                        <p class="text-white/40 text-xs mb-1">Commit</p>
                        <p class="text-white font-mono text-sm">a947dc3</p>
                    </div>
                    <div>
                        <p class="text-white/40 text-xs mb-1">Date</p>
                        <p class="text-white text-sm">24 jan 2026</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- R√©sum√© -->
    <div id="summary" class="glass rounded-3xl p-8 mb-6">
        <div class="flex items-center justify-between">
            <h2 class="text-2xl font-bold text-white">üìä R√©sum√© des Tests</h2>
            <button onclick="runAllTests()" class="px-6 py-3 rounded-xl font-medium text-white transition hover:scale-105" style="background: linear-gradient(135deg, #8b5cf6, #a78bfa);">
                <span id="run-btn-text">‚ñ∂ Lancer les Tests</span>
            </button>
        </div>
        
        <div id="summary-stats" class="mt-6 grid grid-cols-4 gap-4">
            <div class="glass rounded-2xl p-4">
                <p class="text-white/40 text-xs mb-2">Total Tests</p>
                <p class="text-white text-3xl font-bold"><span id="total-tests">0</span></p>
            </div>
            <div class="glass rounded-2xl p-4">
                <p class="text-emerald-400/60 text-xs mb-2">‚úÖ R√©ussis</p>
                <p class="text-emerald-400 text-3xl font-bold"><span id="pass-tests">0</span></p>
            </div>
            <div class="glass rounded-2xl p-4">
                <p class="text-red-400/60 text-xs mb-2">‚ùå √âchou√©s</p>
                <p class="text-red-400 text-3xl font-bold"><span id="fail-tests">0</span></p>
            </div>
            <div class="glass rounded-2xl p-4">
                <p class="text-purple-400/60 text-xs mb-2">Taux R√©ussite</p>
                <p class="text-purple-400 text-3xl font-bold"><span id="success-rate">0</span>%</p>
            </div>
        </div>

        <div id="progress-bar" class="hidden mt-6">
            <div class="w-full h-2 rounded-full" style="background: rgba(255,255,255,0.1);">
                <div id="progress-fill" class="h-2 rounded-full transition-all duration-300" style="background: linear-gradient(90deg, #10b981, #059669); width: 0%;"></div>
            </div>
        </div>
    </div>

    <!-- R√©sultats D√©taill√©s -->
    <div id="test-results" class="space-y-4"></div>

    <!-- Footer Info -->
    <div class="glass rounded-3xl p-6 mt-6">
        <div class="text-center text-white/40 text-sm">
            <p class="mb-2">
                <strong class="text-white/60">Scope v0.1.1:</strong> 
                Login avec mot de passe ‚Ä¢ Navigation Atelier/Biblioth√®que ‚Ä¢ 4 types Biblioth√®que ‚Ä¢ localStorage auth
            </p>
            <p>
                <strong class="text-white/60">Comment utiliser:</strong> 
                Cliquer "Lancer les Tests" ‚Ä¢ V√©rifier que tous sont PASS (verts) ‚Ä¢ Si FAIL (rouge) = Bug d√©tect√©
            </p>
            <p class="mt-4 text-xs">
                ¬© RA2P Production ‚Ä¢ Dtego Forge Test Suite ‚Ä¢ 
                <a href="https://forge.dtego.net" class="text-purple-400 hover:text-purple-300">forge.dtego.net</a>
            </p>
        </div>
    </div>

    <script>
        // ===========================================
        // FRAMEWORK DE TEST SIMPLE
        // ===========================================
        const TestSuite = {
            version: '0.1.1',
            commit: 'a947dc3',
            tests: [],
            results: [],
            currentCategory: null,

            // D√©finir une cat√©gorie de tests
            category(name) {
                this.currentCategory = name;
                console.log(`\nüî∑ ${name}`);
            },

            // Ajouter un test
            test(name, fn) {
                const test = {
                    category: this.currentCategory,
                    name: name,
                    fn: fn,
                    status: null,
                    error: null,
                    duration: 0
                };
                this.tests.push(test);
            },

            // Ex√©cuter tous les tests
            async runAll() {
                this.results = [];
                const startTime = Date.now();

                console.log(`\n${'='.repeat(60)}`);
                console.log(`üß™ FORGE v${this.version} - TESTS AUTOMATIQUES`);
                console.log(`Commit: ${this.commit} ‚Ä¢ ${new Date().toLocaleString('fr-FR')}`);
                console.log(`${'='.repeat(60)}\n`);

                for (let i = 0; i < this.tests.length; i++) {
                    const test = this.tests[i];
                    const testStart = Date.now();

                    try {
                        test.fn();
                        test.status = 'PASS';
                        test.error = null;
                        console.log(`  ‚úÖ ${test.name}`);
                    } catch (error) {
                        test.status = 'FAIL';
                        test.error = error.message;
                        console.error(`  ‚ùå ${test.name}`);
                        console.error(`     ‚Ü≥ ${error.message}`);
                    }

                    test.duration = Date.now() - testStart;
                    this.results.push(test);

                    // Mise √† jour progressive
                    this.updateProgress(i + 1);
                    await new Promise(resolve => setTimeout(resolve, 100)); // Animation
                }

                const totalDuration = Date.now() - startTime;
                
                console.log(`\n${'='.repeat(60)}`);
                const passCount = this.results.filter(r => r.status === 'PASS').length;
                const failCount = this.results.filter(r => r.status === 'FAIL').length;
                console.log(`üìä R√©sultats: ${passCount} PASS ‚Ä¢ ${failCount} FAIL ‚Ä¢ ${totalDuration}ms`);
                console.log(`${'='.repeat(60)}\n`);

                this.displayResults();
            },

            // Mise √† jour barre progression
            updateProgress(current) {
                const percent = Math.round((current / this.tests.length) * 100);
                document.getElementById('progress-fill').style.width = `${percent}%`;
            },

            // Afficher r√©sultats dans UI
            displayResults() {
                const passCount = this.results.filter(r => r.status === 'PASS').length;
                const failCount = this.results.filter(r => r.status === 'FAIL').length;
                const total = this.results.length;
                const successRate = Math.round((passCount / total) * 100);

                // Stats
                document.getElementById('total-tests').textContent = total;
                document.getElementById('pass-tests').textContent = passCount;
                document.getElementById('fail-tests').textContent = failCount;
                document.getElementById('success-rate').textContent = successRate;

                // Grouper par cat√©gorie
                const categories = {};
                this.results.forEach(result => {
                    if (!categories[result.category]) {
                        categories[result.category] = [];
                    }
                    categories[result.category].push(result);
                });

                // Afficher r√©sultats d√©taill√©s
                const container = document.getElementById('test-results');
                container.innerHTML = '';

                Object.keys(categories).forEach(categoryName => {
                    const tests = categories[categoryName];
                    const categoryPass = tests.filter(t => t.status === 'PASS').length;
                    const categoryTotal = tests.length;

                    const categoryDiv = document.createElement('div');
                    categoryDiv.className = 'glass rounded-3xl p-6';
                    
                    categoryDiv.innerHTML = `
                        <div class="test-category rounded-2xl p-4 mb-4">
                            <div class="flex items-center justify-between">
                                <h3 class="text-xl font-bold text-white">${categoryName}</h3>
                                <span class="text-sm ${categoryPass === categoryTotal ? 'text-emerald-400' : 'text-red-400'}">
                                    ${categoryPass}/${categoryTotal} PASS
                                </span>
                            </div>
                        </div>
                        <div class="space-y-2">
                            ${tests.map(test => `
                                <div class="${test.status === 'PASS' ? 'test-pass' : 'test-fail'} rounded-xl p-4">
                                    <div class="flex items-start justify-between">
                                        <div class="flex-1">
                                            <div class="flex items-center gap-2 mb-1">
                                                <span class="text-lg">${test.status === 'PASS' ? '‚úÖ' : '‚ùå'}</span>
                                                <span class="text-white font-medium">${test.name}</span>
                                            </div>
                                            ${test.error ? `
                                                <p class="text-red-400 text-sm ml-7 mt-2">
                                                    ‚Ü≥ ${test.error}
                                                </p>
                                            ` : ''}
                                        </div>
                                        <span class="text-white/40 text-xs">${test.duration}ms</span>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;

                    container.appendChild(categoryDiv);
                });

                // R√©initialiser bouton
                document.getElementById('run-btn-text').textContent = 'üîÑ Re-lancer les Tests';
            }
        };

        // ===========================================
        // TESTS v0.1.1 - FOUNDATION
        // ===========================================

        // ------------------------------------
        // CAT√âGORIE 1: AUTHENTIFICATION (5 tests)
        // ------------------------------------
        TestSuite.category('üîê Authentification');

        TestSuite.test('Mot de passe correct accept√©', () => {
            const PASSWORD = "Fisherman'sfriend";
            const input = "Fisherman'sfriend";
            
            if (input !== PASSWORD) {
                throw new Error('Mot de passe correct devrait √™tre accept√©');
            }
        });

        TestSuite.test('Mot de passe incorrect rejet√©', () => {
            const PASSWORD = "Fisherman'sfriend";
            const input = "mauvais_password";
            
            if (input === PASSWORD) {
                throw new Error('Mot de passe incorrect ne devrait pas √™tre accept√©');
            }
        });

        TestSuite.test('Mot de passe sensible √† la casse', () => {
            const PASSWORD = "Fisherman'sfriend";
            const input = "fisherman'sfriend"; // minuscule
            
            if (input === PASSWORD) {
                throw new Error('Mot de passe devrait √™tre sensible √† la casse');
            }
        });

        TestSuite.test('localStorage auth persistance - Sauvegarde', () => {
            const AUTH_KEY = 'forge_auth';
            
            // Simuler sauvegarde
            localStorage.setItem(AUTH_KEY, 'granted');
            
            // V√©rifier
            const saved = localStorage.getItem(AUTH_KEY);
            if (saved !== 'granted') {
                throw new Error('Auth devrait √™tre sauvegard√©e dans localStorage');
            }
            
            // Cleanup
            localStorage.removeItem(AUTH_KEY);
        });

        TestSuite.test('localStorage auth persistance - Suppression', () => {
            const AUTH_KEY = 'forge_auth';
            
            // Cr√©er puis supprimer
            localStorage.setItem(AUTH_KEY, 'granted');
            localStorage.removeItem(AUTH_KEY);
            
            // V√©rifier suppression
            const deleted = localStorage.getItem(AUTH_KEY);
            if (deleted !== null) {
                throw new Error('Auth devrait pouvoir √™tre supprim√©e');
            }
        });

        // ------------------------------------
        // CAT√âGORIE 2: NAVIGATION (3 tests)
        // ------------------------------------
        TestSuite.category('üß≠ Navigation');

        TestSuite.test('Initialisation - Section par d√©faut Atelier', () => {
            let currentSection = 'atelier';
            
            if (currentSection !== 'atelier') {
                throw new Error('Section par d√©faut devrait √™tre Atelier');
            }
        });

        TestSuite.test('Navigation Atelier ‚Üí Biblioth√®que', () => {
            let currentSection = 'atelier';
            
            // Simuler click Biblioth√®que
            currentSection = 'bibliotheque';
            
            if (currentSection !== 'bibliotheque') {
                throw new Error('Navigation vers Biblioth√®que √©chou√©e');
            }
        });

        TestSuite.test('Navigation Biblioth√®que ‚Üí Atelier', () => {
            let currentSection = 'bibliotheque';
            
            // Simuler click Atelier
            currentSection = 'atelier';
            
            if (currentSection !== 'atelier') {
                throw new Error('Navigation vers Atelier √©chou√©e');
            }
        });

        // ------------------------------------
        // CAT√âGORIE 3: BIBLIOTH√àQUE (7 tests)
        // ------------------------------------
        TestSuite.category('üìö Biblioth√®que - 4 Types');

        TestSuite.test('Nombre de types = 4', () => {
            const types = ['indicator', 'filter', 'strategy', 'filtered_strategy'];
            
            if (types.length !== 4) {
                throw new Error(`Attendu 4 types, trouv√© ${types.length}`);
            }
        });

        TestSuite.test('Type 1: Indicateurs pr√©sent', () => {
            const types = ['indicator', 'filter', 'strategy', 'filtered_strategy'];
            
            if (!types.includes('indicator')) {
                throw new Error('Type "indicator" manquant');
            }
        });

        TestSuite.test('Type 2: Filtres pr√©sent', () => {
            const types = ['indicator', 'filter', 'strategy', 'filtered_strategy'];
            
            if (!types.includes('filter')) {
                throw new Error('Type "filter" manquant');
            }
        });

        TestSuite.test('Type 3: Strat√©gies pr√©sent', () => {
            const types = ['indicator', 'filter', 'strategy', 'filtered_strategy'];
            
            if (!types.includes('strategy')) {
                throw new Error('Type "strategy" manquant');
            }
        });

        TestSuite.test('Type 4: Strat√©gies Filtr√©es pr√©sent', () => {
            const types = ['indicator', 'filter', 'strategy', 'filtered_strategy'];
            
            if (!types.includes('filtered_strategy')) {
                throw new Error('Type "filtered_strategy" manquant');
            }
        });

        TestSuite.test('Ordre des types respect√©', () => {
            const types = ['indicator', 'filter', 'strategy', 'filtered_strategy'];
            const expected = ['indicator', 'filter', 'strategy', 'filtered_strategy'];
            
            const isOrdered = JSON.stringify(types) === JSON.stringify(expected);
            
            if (!isOrdered) {
                throw new Error(`Ordre incorrect: ${types.join(', ')}`);
            }
        });

        TestSuite.test('Noms types coh√©rents avec architecture modulaire', () => {
            const types = ['indicator', 'filter', 'strategy', 'filtered_strategy'];
            
            // V√©rifier nomenclature
            const validNaming = types.every(type => {
                return type === type.toLowerCase() && // minuscules
                       type.indexOf(' ') === -1; // pas d'espaces
            });
            
            if (!validNaming) {
                throw new Error('Nomenclature types invalide');
            }
        });

        // ===========================================
        // FONCTION LANCEMENT TESTS
        // ===========================================
        async function runAllTests() {
            // D√©sactiver bouton
            const btn = document.getElementById('run-btn-text');
            btn.innerHTML = '<span class="pulse">‚è≥ Tests en cours...</span>';
            
            // Afficher barre progression
            document.getElementById('progress-bar').classList.remove('hidden');
            document.getElementById('progress-fill').style.width = '0%';
            
            // Lancer tests
            await TestSuite.runAll();
            
            // Masquer barre progression
            setTimeout(() => {
                document.getElementById('progress-bar').classList.add('hidden');
            }, 500);
        }

        // ===========================================
        // AUTO-EX√âCUTION (Optionnel)
        // ===========================================
        // D√©commenter pour lancer tests automatiquement au chargement:
        // window.addEventListener('DOMContentLoaded', runAllTests);

        console.log('%cüß™ Forge v0.1.1 Test Suite Charg√©e', 'color: #8b5cf6; font-size: 16px; font-weight: bold;');
        console.log('%cCliquer "Lancer les Tests" ou taper: runAllTests()', 'color: #a78bfa; font-size: 12px;');
    </script>
</body>
</html>
